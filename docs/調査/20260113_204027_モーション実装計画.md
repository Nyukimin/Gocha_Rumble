# 1000体描画のためのモーション実装・調達計画

**作成日**: 2026-01-13
**課題**: 1000体のキャラクターに「生き生きとした動き」を与えつつ、60fpsを維持するための技術選定と素材調達。

---

## 1. 技術的アプローチ：CPUを使わずGPUで動かす

通常のゲーム（ボーンアニメーション）はCPU負荷が高く、1000体では処理落ちします。
本プロジェクトでは、以下の**「負荷の低いフェイク手法」**をメインに採用します。

### A. 頂点シェーダーアニメーション (推奨：ザコ敵・遠景)
*   **仕組み**: 3Dモデルの頂点を、GPU（シェーダー）で計算式に基づいて波打たせる。
*   **表現**:
    *   スライムのように「ぷるぷる」震える。
    *   脚を使わず、ホバー移動のように「浮遊」して上下する。
    *   走る時に全体が「前後に伸縮」する。
*   **メリット**: **CPU負荷ほぼゼロ**。1000体いても重くならない。
*   **デメリット**: 複雑な「剣を振る」「転ぶ」などの動作は苦手。

### B. Vertex Animation Texture (VAT) (推奨：近景・ボス・メイン動作)
*   **仕組み**: 「歩く」「攻撃」などの複雑なアニメーションを、事前に**「テクスチャ画像」**として焼き込んでおく。GPUは画像をパラパラ漫画のように読み込んで頂点を動かす。
*   **メリット**: ボーンアニメーションと同等のリッチな動きができるのに、負荷は非常に低い。
    *   **Q**: 「演算（ボーン計算）」と「ロード（VAT）」どっちが軽い？
    *   **A**: **圧倒的にVAT（ロード）が軽い**。1000体の場合、CPU演算はボトルネックになるが、VATならGPUのみで完結するため。
*   **デメリット**: テクスチャ容量を食う。事前にBlender等で変換作業（Baking）が必要。

---

## 2. モーション素材の調達方法

### A. Adobe Mixamo (無料)
*   **概要**: 汎用的な人型・クリーチャー用アニメーションの巨大ライブラリ。
*   **使い方**: 自作のローポリモデルをアップロードすると、自動で骨を入れて（Auto-Rig）、選んだ動き（Walk, Attack, Die等）を適用してくれる。
*   **採用案**: 「人型メカ」や「二足歩行ロボ」はこれで動きを作り、BlenderでVATに焼き込む。

### B. プロシージャル（コード制御）
*   **概要**: プログラムで動きを作る。
*   **使い方**: Boids（群集）の移動速度に合わせて、モデルを「進行方向に傾ける（バンク）」、「着地時にスケールを潰す（スクワッシュ＆ストレッチ）」などの処理を入れる。
*   **採用案**: 浮遊型ドローン、球体型ロボットなど。

---

## 3. 実装指針（LOD戦略との組み合わせ）

距離に応じて、アニメーション処理も切り替えます。

| 距離 | モデル | アニメーション手法 | 備考 |
| :--- | :--- | :--- | :--- |
| **近距離 (〜20m)** | 詳細モデル | **VAT (画像焼き込み)** | Mixamoで作ったリッチな「攻撃」「被弾」を再生。 |
| **中距離 (〜100m)** | 簡易モデル | **シェーダー (数式)** | 「ぷるぷる」「上下動」のみ。攻撃モーションは省略（エフェクトのみ）。 |
| **遠距離 (100m〜)** | 極小モデル | **なし (静止画)** | 動かさない。移動のみ。 |

---

## 4. 担当者への指示（Step 1向け）

### エンジニア向けタスク
1.  **VAT検証**: BlenderからVAT（テクスチャ）を書き出し、Three.jsの `InstancedMesh` で再生するデモを作成する。
    *   ※参考ライブラリ: `three-vat` などを調査。
2.  **シェーダー作成**: `onBeforeCompile` を使い、頂点を `sin(time)` で揺らす簡易シェーダーを作成する。

### デザイナー/モデラー（兼任）向けタスク
1.  **Mixamoテスト**: ローポリモデルをMixamoに通し、きれいに動くか（関節が破綻しないか）確認する。
2.  **ボーン削除**: Mixamoで動きを作った後は、VATに焼くため**ボーン情報は削除**して良いことを理解する。

---

## 5. 結論

*   **どうする？**: 「骨」計算はせず、**「テクスチャ（VAT）」**と**「数式（シェーダー）」**で動かします。
*   **素材は？**: Adobe Mixamoを活用し、手間をかけずにリッチな動きを確保します。
*   **大事なこと**: 「1000体全員が複雑に動く必要はない」という割り切りが、60fps維持の鍵です。
