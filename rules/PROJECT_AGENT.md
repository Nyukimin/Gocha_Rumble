# PROJECT_AGENT.md - Gocha Rumble 3D プロジェクトルール

**プロジェクト名**: Gocha Rumble 3D
**目標**: 数千のユニットが戦う様子をユーザーが観戦する「可愛い × カオス」な3D自動バトラーを作成する。
**技術スタック**:
- **フロントエンド**: Vite + React + Three.js (R3F)
- **言語**: TypeScript
- **バックエンド**: Firebase (Auth, Firestore)

---

## 0. グローバル宣言

### 0.1 マネージャ層の実装禁止

あなたはマネージャで、agentオーケストレーターです。
あなたは絶対に実装せず、全てsubagentやtask agent に委託すること。
タスクは超細分化し、PDCAサイクルを構築すること

## 1. コア原則

### 1.1 "Cute & Minimal" エステティック
- **デザイン**: かわいいメカデザイン（メカニカルな要素を持ちながらも可愛らしい見た目）。パステルカラーを基調とした配色。
- **アニメーション**: 複雑なスケルタルアニメーションではなく、物理ベースの「揺れる」動きを使用する。
- **UI**: クリーンでモダン、目立たないデザイン。

調査委文化調査委文化### 1.2 パフォーマンス優先
- **目標**: 1,000以上のユニットで60 FPSを維持する。
- **技術**: ユニットのレンダリングには `InstancedMesh` を必ず使用する。
- **制約**: ユニットごとの個別のDraw Callを避ける。

### 1.3 非同期PvP
- **モデル**: 「ゴースト」バトル。
- **データ**: チーム構成をFirestoreに保存する。
- **ロジック**: シミュレーションはクライアント側で決定論的に実行される。

---

## 2. プロジェクト構造

- `src/`: ソースコード
  - `components/`: Reactコンポーネント
  - `game/`: ゲームロジック (Three.jsシーン、システム)
  - `firebase/`: Firebase設定とフック
- `docs/`: ドキュメント
- `tests/`: テスト

---
## 3. ドキュメントルール

### 3.1 命名規則（必須）

**重要**: `docs/`フォルダ配下のすべてのファイル名は**必ず日本語**を使用すること。

- **適用範囲**: `docs/`直下およびすべてのサブフォルダ内のファイル
- **形式**: `YYYYMMDD_HHMMSS_説明的なタイトル.md` (JST)
- **タイトル部分**: 日本語で記述すること（英語は使用不可）
- **例（正）**: 
  - `20251213_153000_バトルシステム.md`
  - `20251213_153000_製品仕様書.md`
  - `20251213_153000_ユニットシステム設計.md`
  - `AIからの提案.md`（直下ファイルも日本語）
- **例（誤）**: 
  - `20251213_153000_battle_system.md` ❌
  - `20251213_153000_product_specification.md` ❌
  - `AI_proposal.md` ❌

### 3.2 各フォルダの用途

- **`docs/仕様`**: ユーザーのリクエストを製品仕様として整理した記述を保存する。
  - 要件定義書、機能仕様書、製品仕様書など。
  - 命名規則: `YYYYMMDD_HHMMSS_説明的なタイトル.md` (JST、日本語必須)
  - 例: `20251213_153000_バトルシステム仕様.md`

- **`docs/実装仕様`**: 実装の詳細仕様を記述する。
  - 技術的な実装方法、アーキテクチャ、設計詳細など。
  - 命名規則: `YYYYMMDD_HHMMSS_説明的なタイトル.md` (JST、日本語必須)
  - 例: `20251213_153000_バトルシステム実装仕様.md`

- **`docs/調査`**: 調査記録を保存する。
  - 不具合分析、技術調査、問題解決の記録など。
  - 詳細は `rules/common/rules_logging.md` を参照。
  - 命名規則: `YYYYMMDD_hhmmss_説明的なタイトル.md` (JST、日本語必須)
---
## 4. 技術スタック詳細

### 4.1 Three.js / R3F
- シーンの確認には `@react-three/fiber` を使用する。
- ユーティリティ（OrbitControlsなど）には `@react-three/drei` を使用する。

### 4.2 Firebase
- **認証**: Google Sign-Inのみ。
- **Firestore**: ユーザープロファイルとチームデータを保存する。

---

## 5. Git運用ルール

### 5.1 コミットメッセージ（UTF-8日本語対応）

**重要**: コミットメッセージは**必ず日本語**で記述すること。

- **文字エンコーディング**: UTF-8
- **問題**: PowerShellから `git commit -m` で日本語を含むメッセージを直接指定すると、エンコーディングエラーが発生する場合がある
- **解決方法**: コミットメッセージをファイルから読み込む方法を使用する

#### 推奨方法

1. **コミットメッセージファイルを作成**:
   ```bash
   # commit_message.txt を作成（UTF-8で保存）
   ```

2. **ファイルからコミット**:
   ```bash
   git commit -F commit_message.txt
   ```

3. **一時ファイルを削除**:
   ```bash
   # コミット後、commit_message.txt を削除
   ```

#### コミットメッセージの形式

- **形式**: `種類: 簡潔な説明（詳細な説明）`
- **種類**: `docs`, `feat`, `fix`, `refactor`, `style`, `test` など
- **例**: 
  - `docs: ユニットデザイン詳細の仕様を追加（200体表示、300-400ポリゴン、SDガンダム的挙動）`
  - `feat: バトルシステムの実装を追加`

---

## 6. 参照ルール
- **ドメインルール**: `rules/rules_domain.md`
- **共通ルール**: `rules/common/GLOBAL_AGENT.md`
