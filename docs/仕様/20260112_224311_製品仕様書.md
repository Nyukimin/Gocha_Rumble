# Gocha Rumble 3D 製品仕様書

**作成日**: 2026-01-12  
**バージョン**: 1.0  
**ステータス**: 初版

---

## 1. ゲーム概要

### 1.1 プロジェクト情報

- **タイトル**: Gocha Rumble 3D
- **ジャンル**: 3Dオートバトラー / 放置ゲーム / コチャキャラ系
- **プラットフォーム**: Webブラウザ（PCでの閲覧を想定）
- **技術スタック**:
  - フロントエンド: Vite + React + Three.js (R3F)
  - 言語: TypeScript
  - バックエンド: Firebase (Authentication, Firestore)

### 1.2 コアコンセプト

1. **「ゴチャキャラ」感**: 画面上に大量のキャラクター（数千体規模）を表示
2. **「かわいさ」**: かわいいメカデザイン（メカニカルな要素を持ちながらも可愛らしい見た目）
3. **「見守る」楽しさ**: 最初の設定（ビルド）を行ったら、あとはゲームオーバーまで放置して眺めるだけ
4. **視点操作**: 自由なカメラ操作が可能（360度、ズーム等）

### 1.3 ターゲットユーザー

- 放置ゲーム好きのユーザー
- 3Dビジュアルを楽しみたいユーザー
- ハクスラ・ローグライク要素を好むユーザー
- 非同期PvPで競争を楽しみたいユーザー

---

## 2. ゲームシステム詳細

### 2.1 バトルシステム

#### 2.1.1 バトル形式

- **形式**: サバイバル制
- **特徴**: 
  - 連続出現システム（常に敵が出現し続ける）
  - 敵を倒し続けることでスコアを獲得
  - 全ユニットが倒されるまで継続

#### 2.1.2 敵の出現パターン

- **基本出現**: 常に敵が連続して出現
- **難易度上昇**: 時間経過と共に段階的に敵が強くなる
  - 敵のHP、攻撃力、出現数が増加
  - 出現間隔が短くなる可能性
- **ボス出現**: 定期的にボスが出現
  - 通常の敵より大幅に強い
  - 撃破で特別な報酬や進化ポイントを獲得

#### 2.1.3 ゲームオーバー条件

- **条件**: 全ユニットが倒される
- **判定**: プレイヤー側のユニットが全てHP0になった時点

### 2.2 ユニットシステム

#### 2.2.1 基本タイプ

ユニットは以下のシンプルなタイプに分類される：

- **近接タイプ**: 敵に接近して物理攻撃を行う
- **遠距離タイプ**: 遠距離から攻撃を行う
- **支援タイプ**: 味方を回復・強化する

#### 2.2.2 リアルタイム進化システム

- **進化ポイント**: 敵を倒すと進化ポイントが獲得できる
- **進化条件**: 一定数の進化ポイントが貯まると自動的に進化
- **進化効果**: 
  - ステータス向上（HP、攻撃力、防御力など）
  - 見た目の変化（より強そうな見た目に）
  - 新たな能力の獲得（可能性）

#### 2.2.3 カスタマイズシステム

- **基本**: 固定タイプのユニットに装備やアイテムで個性化
- **装備**: バトル中にガチャで獲得した装備を装備可能
- **効果**: 装備により一時的な強化が可能

### 2.3 ガチャシステム

#### 2.3.1 バトル中のガチャ

- **タイミング**: バトル中に特定の条件でガチャを引ける
- **獲得内容**: 装備・アイテム（一時的な強化）
  - 攻撃力アップ
  - 防御力アップ
  - 特殊効果付与
  - その他の一時的強化アイテム

#### 2.3.2 ガチャの引き方

- **自動**: 一定条件を満たすと自動的に発動
- **手動**: プレイヤーがタイミングを選択（要確認）

### 2.4 敵システム

#### 2.4.1 敵の種類

- **通常敵**: 基本的な敵ユニット
- **強化敵**: 時間経過で出現する強化された敵
- **ボス**: 定期的に出現する強力な敵

#### 2.4.2 敵の行動

- **AI**: 自動的にプレイヤー側のユニットを攻撃
- **行動パターン**: シンプルな接近→攻撃のループ

---

## 3. ゲームフロー

### 3.1 セットアップフェーズ

バトル開始前に以下の設定を行う：

1. **チーム編成**
   - 使用するユニットを選択
   - ユニットの種類と数を決定

2. **初期装備の選択**
   - 各ユニットに初期装備を設定
   - 装備による初期ステータス調整

3. **陣形設定**
   - ユニットの配置位置を決定
   - 陣形による戦略的配置

4. **難易度選択**
   - ゲームの難易度を選択
   - 難易度により敵の強さや報酬が変化

### 3.2 バトルフェーズ

1. **開始**: セットアップ完了後、自動的にバトル開始
2. **進行**: 
   - 敵が連続して出現
   - ユニットが自動的に戦闘
   - 敵を倒すと進化ポイント獲得
   - 一定条件でガチャが発動
   - 進化ポイントが貯まるとユニットが進化
3. **操作**: カメラ操作のみ（完全放置）
4. **終了**: 全ユニットが倒されるまで継続

### 3.3 リザルトフェーズ

ゲームオーバー後に以下の情報を表示：

1. **生存時間**: どれだけ長く生き延びたか
2. **撃破数**: 倒した敵の総数
3. **到達ウェーブ/レベル**: 到達した難易度レベル
4. **獲得報酬**: 
   - 通貨
   - アイテム
   - その他の報酬
5. **ランキング**: 非同期PvPでの順位
6. **リプレイ機能**: バトルの再現（要実装詳細）

---

## 4. UI/UX設計

### 4.1 セットアップ画面

- **レイアウト**: 
  - チーム編成エリア
  - 装備選択エリア
  - 陣形設定エリア
  - 難易度選択UI
- **操作性**: ドラッグ&ドロップ、クリック選択など直感的な操作

### 4.2 バトル画面

#### 4.2.1 3Dビュー

- **カメラ操作**: 
  - 360度回転
  - ズームイン/アウト
  - 自由な視点移動
- **表示**: 
  - 数千体のユニットと敵を表示
  - かわいいメカデザインのキャラクター
  - パステルカラーを基調とした配色
  - 物理ベースの「揺れる」動き

#### 4.2.2 HUD（ヘッドアップディスプレイ）

- **表示要素**:
  - 生存時間
  - 撃破数
  - 現在のウェーブ/レベル
  - 進化ポイントの進捗
  - ユニットのHP状況
  - ガチャの状態（発動可能かなど）

#### 4.2.3 ダメージ表示

- **ポップアップ数値**: ダメージ数値がビルボードテキストで表示
- **ハクスラ感**: 数値が飛び散る演出

### 4.3 リザルト画面

- **レイアウト**:
  - 統計情報の表示（生存時間、撃破数、到達ウェーブ）
  - 獲得報酬の表示
  - ランキング表示
  - リプレイボタン
  - 次のバトルへボタン

---

## 5. 技術要件

### 5.1 パフォーマンス目標

- **目標FPS**: 60 FPS
- **ユニット数**: 1,000以上のユニットを同時表示
- **技術**: `InstancedMesh`を必ず使用
- **制約**: ユニットごとの個別のDraw Callを避ける

### 5.2 技術スタック詳細

#### 5.2.1 フロントエンド

- **ビルドツール**: Vite
- **フレームワーク**: React
- **3Dライブラリ**: Three.js
- **React Three.js統合**: @react-three/fiber
- **ユーティリティ**: @react-three/drei（OrbitControlsなど）

#### 5.2.2 バックエンド

- **認証**: Firebase Authentication（Google Sign-Inのみ）
- **データベース**: Firestore
  - ユーザープロファイル
  - チームデータ
  - ランキングデータ

### 5.3 非同期PvPシステム

#### 5.3.1 ゴーストバトル

- **モデル**: 「ゴースト」バトル
- **データ保存**: チーム構成をFirestoreに保存
- **シミュレーション**: クライアント側で決定論的に実行

#### 5.3.2 ランキングシステム

- **リーダーボード**: 生存時間、撃破数などでランキング
- **更新**: バトル終了後に自動更新

---

## 6. デザインガイドライン

### 6.1 ビジュアルスタイル

- **デザイン**: かわいいメカデザイン
  - メカニカルな要素（ギア、パーツ、機械的な構造）を持ちながらも可愛らしい見た目
  - プリミティブ形状（球体、カプセル、ボックスなど）を組み合わせてメカ的な形状を構成
  - シンプルで認識しやすいデザイン（数千体表示時のパフォーマンスを考慮）
- **カラー**: パステルカラーを基調とした配色
- **アニメーション**: 物理ベースの「揺れる」動き
- **UI**: クリーンでモダン、目立たないデザイン

### 6.2 パフォーマンス最適化

- **レンダリング**: InstancedMeshを使用
- **物理演算**: シンプルな半径ベースの衝突判定
- **メモリ管理**: シーンのアンマウント時にジオメトリとマテリアルを破棄

---

## 7. 未決定事項・今後の検討項目

### 7.1 プレイヤーの成長・進行要素

現時点では以下の要素が未決定：

- バトル間の成長システム
- 永続的な強化要素
- ユニットの収集・育成システム
- 通貨・リソースの用途

### 7.2 その他の検討事項

- ガチャの引き方（自動/手動）
- リプレイ機能の実装詳細
- 装備システムの詳細（装備の種類、効果の種類）
- 進化の段階数と効果の詳細
- ボスの出現間隔と種類

---

## 8. 参照資料

- **ユーザーリクエスト**: `docs/ユーザーのリクエスト.md`
- **プロジェクトルール**: `rules/PROJECT_AGENT.md`
- **ドメインルール**: `rules/rules_domain.md`
- **共通ルール**: `rules/common/GLOBAL_AGENT.md`

---

## 9. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2026-01-12 | 1.0 | 初版作成 | - |
| 2026-01-12 | 1.1 | キャラクターデザインを「かわいいメカ」に変更 | - |