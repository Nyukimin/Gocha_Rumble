# Gocha Rumble 3D 製品仕様書

**作成日**: 2026-01-12  
**バージョン**: 1.0  
**ステータス**: 初版

---

## 1. ゲーム概要

### 1.1 プロジェクト情報

- **タイトル**: Gocha Rumble 3D
- **ジャンル**: 3Dオートバトラー / 放置ゲーム / コチャキャラ系
- **プラットフォーム**: Webブラウザ（PCでの閲覧を想定）
- **技術スタック**:
  - フロントエンド: Vite + React + Three.js (R3F)
  - 言語: TypeScript
  - バックエンド: Firebase (Authentication, Firestore)

### 1.2 コアコンセプト

1. **「ゴチャキャラ」感**: 画面上に大量のキャラクター（数千体規模）を表示
2. **「かわいさ」**: かわいいメカデザイン（メカニカルな要素を持ちながらも可愛らしい見た目）
3. **「見守る」楽しさ**: 最初の設定（ビルド）を行ったら、あとはゲームオーバーまで放置して眺めるだけ
4. **視点操作**: 自由なカメラ操作が可能（360度、ズーム等）

### 1.3 ターゲットユーザー

- 放置ゲーム好きのユーザー
- 3Dビジュアルを楽しみたいユーザー
- ハクスラ・ローグライク要素を好むユーザー
- 非同期PvPで競争を楽しみたいユーザー

---

## 2. ゲームシステム詳細

### 2.1 バトルシステム

#### 2.1.1 バトル形式

- **形式**: サバイバル制
- **特徴**: 
  - 連続出現システム（常に敵が出現し続ける）
  - 敵を倒し続けることでスコアを獲得
  - 全ユニットが倒されるまで継続

#### 2.1.2 敵の出現パターン

- **基本出現**: 常に敵が連続して出現
- **難易度上昇**: 時間経過と共に段階的に敵が強くなる
  - 敵のHP、攻撃力、出現数が増加
  - 出現間隔が短くなる可能性
- **ボス出現**: 定期的にボスが出現
  - 通常の敵より大幅に強い
  - 撃破で特別な報酬や進化ポイントを獲得

#### 2.1.3 ゲームオーバー条件

- **条件**: 全ユニットが倒される
- **判定**: プレイヤー側のユニットが全てHP0になった時点

### 2.2 ユニットシステム

#### 2.2.1 基本タイプ

ユニットは以下のシンプルなタイプに分類される：

- **近接タイプ**: 敵に接近して物理攻撃を行う
- **遠距離タイプ**: 遠距離から攻撃を行う
- **支援タイプ**: 味方を回復・強化する

#### 2.2.2 リアルタイム進化システム

- **進化ポイント**: 敵を倒すと進化ポイントが獲得できる
- **進化条件**: 一定数の進化ポイントが貯まると自動的に進化
- **進化効果**: 
  - ステータス向上（HP、攻撃力、防御力など）
  - 見た目の変化（より強そうな見た目に）
  - 新たな能力の獲得（可能性）

#### 2.2.3 カスタマイズシステム

- **基本**: 固定タイプのユニットに装備やアイテムで個性化
- **装備**: バトル中にガチャで獲得した装備を装備可能
- **効果**: 装備により一時的な強化が可能

### 2.3 ガチャシステム

#### 2.3.1 バトル中のガチャ

- **タイミング**: バトル中に特定の条件でガチャを引ける
- **獲得内容**: 装備・アイテム（一時的な強化）
  - 攻撃力アップ
  - 防御力アップ
  - 特殊効果付与
  - その他の一時的強化アイテム

#### 2.3.2 ガチャの引き方

- **自動**: 一定条件を満たすと自動的に発動
- **手動**: プレイヤーがタイミングを選択（要確認）

### 2.4 敵システム

#### 2.4.1 敵の種類

- **通常敵**: 基本的な敵ユニット
- **強化敵**: 時間経過で出現する強化された敵
- **ボス**: 定期的に出現する強力な敵

#### 2.4.2 敵の行動

- **AI**: 自動的にプレイヤー側のユニットを攻撃
- **行動パターン**: シンプルな接近→攻撃のループ

---

## 3. ゲームフロー

### 3.1 セットアップフェーズ

バトル開始前に以下の設定を行う：

1. **チーム編成**
   - 使用するユニットを選択
   - ユニットの種類と数を決定

2. **初期装備の選択**
   - 各ユニットに初期装備を設定
   - 装備による初期ステータス調整

3. **陣形設定**
   - ユニットの配置位置を決定
   - 陣形による戦略的配置

4. **難易度選択**
   - ゲームの難易度を選択
   - 難易度により敵の強さや報酬が変化

### 3.2 バトルフェーズ

1. **開始**: セットアップ完了後、自動的にバトル開始
2. **進行**: 
   - 敵が連続して出現
   - ユニットが自動的に戦闘
   - 敵を倒すと進化ポイント獲得
   - 一定条件でガチャが発動
   - 進化ポイントが貯まるとユニットが進化
3. **操作**: カメラ操作のみ（完全放置）
4. **終了**: 全ユニットが倒されるまで継続

### 3.3 リザルトフェーズ

ゲームオーバー後に以下の情報を表示：

1. **生存時間**: どれだけ長く生き延びたか
2. **撃破数**: 倒した敵の総数
3. **到達ウェーブ/レベル**: 到達した難易度レベル
4. **獲得報酬**: 
   - 通貨
   - アイテム
   - その他の報酬
5. **ランキング**: 非同期PvPでの順位
6. **リプレイ機能**: バトルの再現（要実装詳細）

---

## 4. UI/UX設計

### 4.1 セットアップ画面

- **レイアウト**: 
  - チーム編成エリア
  - 装備選択エリア
  - 陣形設定エリア
  - 難易度選択UI
- **操作性**: ドラッグ&ドロップ、クリック選択など直感的な操作

### 4.2 バトル画面

#### 4.2.1 3Dビュー

- **カメラ操作**: 
  - 360度回転
  - ズームイン/アウト
  - 自由な視点移動
- **表示**: 
  - 数千体のユニットと敵を表示
  - かわいいメカデザインのキャラクター
  - パステルカラーを基調とした配色
  - 物理ベースの「揺れる」動き

#### 4.2.2 HUD（ヘッドアップディスプレイ）

- **表示要素**:
  - 生存時間
  - 撃破数
  - 現在のウェーブ/レベル
  - 進化ポイントの進捗
  - ユニットのHP状況
  - ガチャの状態（発動可能かなど）

#### 4.2.3 ダメージ表示

- **ポップアップ数値**: ダメージ数値がビルボードテキストで表示
- **ハクスラ感**: 数値が飛び散る演出

### 4.3 リザルト画面

- **レイアウト**:
  - 統計情報の表示（生存時間、撃破数、到達ウェーブ）
  - 獲得報酬の表示
  - ランキング表示
  - リプレイボタン
  - 次のバトルへボタン

---

## 5. 技術要件

### 5.1 パフォーマンス目標

- **目標FPS**: 60 FPS
- **ユニット数**: 1,000以上のユニットを同時表示
- **技術**: `InstancedMesh`を必ず使用
- **制約**: ユニットごとの個別のDraw Callを避ける

### 5.2 技術スタック詳細

#### 5.2.1 フロントエンド

- **ビルドツール**: Vite
- **フレームワーク**: React
- **3Dライブラリ**: Three.js
- **React Three.js統合**: @react-three/fiber
- **ユーティリティ**: @react-three/drei（OrbitControlsなど）

#### 5.2.2 バックエンド

- **認証**: Firebase Authentication（Google Sign-Inのみ）
- **データベース**: Firestore
  - ユーザープロファイル
  - チームデータ
  - ランキングデータ

### 5.3 非同期PvPシステム

#### 5.3.1 ゴーストバトル

- **モデル**: 「ゴースト」バトル
- **データ保存**: チーム構成をFirestoreに保存
- **シミュレーション**: クライアント側で決定論的に実行

#### 5.3.2 ランキングシステム

- **リーダーボード**: 生存時間、撃破数などでランキング
- **更新**: バトル終了後に自動更新

---

## 6. デザインガイドライン

### 6.1 ビジュアルスタイル

- **デザイン**: かわいいメカデザイン
  - メカニカルな要素（ギア、パーツ、機械的な構造）を持ちながらも可愛らしい見た目
  - プリミティブ形状（球体、カプセル、ボックスなど）を組み合わせてメカ的な形状を構成
  - シンプルで認識しやすいデザイン（数千体表示時のパフォーマンスを考慮）
- **カラー**: パステルカラーを基調とした配色
- **アニメーション**: 物理ベースの「揺れる」動き
- **UI**: クリーンでモダン、目立たないデザイン

### 6.2 パフォーマンス最適化

- **レンダリング**: InstancedMeshを使用
- **物理演算**: シンプルな半径ベースの衝突判定
- **メモリ管理**: シーンのアンマウント時にジオメトリとマテリアルを破棄

---

## 7. 未決定事項・今後の検討項目

### 7.1 プレイヤーの成長・進行要素

現時点では以下の要素が未決定：

- バトル間の成長システム
- 永続的な強化要素
- ユニットの収集・育成システム
- 通貨・リソースの用途

### 7.2 その他の検討事項

- ガチャの引き方（自動/手動）
- リプレイ機能の実装詳細
- 装備システムの詳細（装備の種類、効果の種類）
- 進化の段階数と効果の詳細
- ボスの出現間隔と種類

---

## 8. 設計思想とコンセプト詳細

### 8.1 全体コンセプト

#### 8.1.1 ゴチャキャラを「眺めて気持ちいい現象」にする

- **ポイント**: ゴチャキャラを「眺めて気持ちいい現象」にする（観戦・放置が主役）
- **意味**: 操作量で勝負せず、画面体験（密度・変化・成長）で刺す。初見の理解コストが低い

#### 8.1.2 トレーディング（交換・市場）は入れない

- **ポイント**: トレーディング（交換・市場）は入れない
- **意味**: 経済で寿命を作らず、ビルドの試行錯誤と"変化の快感"で回す

#### 8.1.3 ジャンルはハクスラ＋ローグライト

- **ポイント**: ジャンルはハクスラ＋ローグライト
- **意味**: ラン内で派手に強くなって壊れる／ラン間では強さを積み上げず「選択肢」を増やす

---

### 8.2 世界観の確定（テラリウム案）

#### 8.2.1 舞台は隔離テラリウム（実験区画）

- **ポイント**: 舞台は隔離テラリウム（実験区画）
- **意味**: 水槽視点（トップ/クォータービュー）が自然。章立てと環境差分が作りやすい

#### 8.2.2 主人公はロボ（単騎のオペレーター機）

- **ポイント**: 主人公はロボ（単騎のオペレーター機）
- **意味**: 主役の存在感を確保し、ズーム時に迷子にならない

#### 8.2.3 敵は生物的な侵食体（増殖・変異する群体）

- **ポイント**: 敵は生物的な侵食体（増殖・変異する群体）
- **意味**: テラリウムとして納得感があり、群れの快感と相性が良い

#### 8.2.4 目的は「侵食の封じ込め」＋「サンプル回収（同僚機化）」＋「区画を進んで中枢封鎖」

- **ポイント**: 目的は「侵食の封じ込め」＋「サンプル回収（同僚機化）」＋「区画を進んで中枢封鎖」
- **意味**: 章導入（ロビー）の意思決定、撤退、捕獲、報酬の文言が一本につながる

---

### 8.3 操作設計（介入ポイントの前提）

#### 8.3.1 主な介入は「ゲーム開始前のロビー」＋「各章の導入パート」

- **ポイント**: 主な介入は「ゲーム開始前のロビー」＋「各章の導入パート」
- **意味**: 意思決定を落ち着いて行える。放置観戦のテンポが崩れない

#### 8.3.2 ゲーム中の操作は基本「ズーム変更」程度

- **ポイント**: ゲーム中の操作は基本「ズーム変更」程度
- **意味**: プレイ中の操作負荷を増やさず、観戦の快感を保つ

---

### 8.4 カメラ・表示数（決定事項）

#### 8.4.1 通常表示は120〜220体（読める密度）

- **ポイント**: 通常表示は120〜220体（読める密度）
- **意味**: 進化・ビルド・役割が視認でき、ローグライトの成果が"見える"

#### 8.4.2 ズームアウト階層は「1000体で回し続ける」

- **ポイント**: ズームアウト階層は「1000体で回し続ける」。変わるのは描画対象（LOD/表示）だけ
- **意味**: 演出だけでなく、世界が本当に群れている手触りを担保する（ロジックも1000で稼働）

#### 8.4.3 ズームあり（マクロ⇄ミクロの切替）

- **ポイント**: ズームあり（マクロ⇄ミクロの切替）
- **意味**:
  - 引き＝群れ・密度・現象の快感
  - 寄り＝自機中心のビルド成果・進化差分の理解
    を両立できる

---

### 8.5 進行構造（章立て＋撤退）

#### 8.5.1 無限に見えるが、内部は「章（区画）」で区切る

- **ポイント**: 無限に見えるが、内部は「章（区画）」で区切る
- **意味**: 目的が消えない。短い成功体験を積み上げられる

#### 8.5.2 撤退（緊急回収）を前提にし、撤退＝上手いプレイになり得る

- **ポイント**: 撤退（緊急回収）を前提にし、撤退＝上手いプレイになり得る
- **意味**: ローグの"残らなさ"を守りつつ、時間投資が無駄になった感を消す

#### 8.5.3 章差分は敵種類より先に「環境条件」で作る

- **ポイント**: 章差分は敵種類より先に「環境条件」で作る
- **意味**: テラリウムらしさが出る。ローグライトの分岐（どの区画に行くか）が成立する
- **例**: 霧／磁気／重力など（挙動・射程・密度が変わる）

---

### 8.6 自機と同僚機（単騎＋仲間獲得）

#### 8.6.1 自機は単騎が主役。仲間（同僚機）は章を進む中で増える

- **ポイント**: 自機は単騎が主役。仲間（同僚機）は章を進む中で増える
- **意味**: 主役の可視性を守りつつ、ハクスラの"増える快感"を作れる

#### 8.6.2 同僚機の獲得経路は「敵キャプチャ」または「アイテム追加」

- **ポイント**: 同僚機の獲得経路は「敵キャプチャ」または「アイテム追加」
- **意味**: ローグライトのラン内ドラマ（今日は何が仲間になるか）を作れる

---

### 8.7 捕獲（キャプチャ）の扱い

#### 8.7.1 捕獲は面白いが、ゲーム中操作を増やさない方針に合わせる

- **ポイント**: 捕獲は面白いが、ゲーム中操作を増やさない方針に合わせる
- **意味**: 捕獲は"章の結果として発生"し、採用・編成は次章ロビーで行うのが自然

#### 8.7.2 難易度3段階のうち、推奨は「状態条件捕獲」（レベル2）

- **ポイント**: 難易度3段階のうち、推奨は「状態条件捕獲」（レベル2）
- **意味**: 捕獲がビルド（捕獲寄り構成）として成立するが、専用アクションを増やさない
- **例**: HP閾値以下／特定デバフ中などで捕獲可能フラグ→成功で同僚候補に

#### 8.7.3 捕獲はバランス破壊しやすいので上限と制限を前提にする

- **ポイント**: 捕獲はバランス破壊しやすいので上限と制限を前提にする
- **意味**: 雪だるま化を防ぎ、調整と実装を軽くする
- **例**: 捕獲対象タイプ制限／同僚数上限／章内回数制限など

---

### 8.8 報酬設計（ローグの「残らない」×ハクスラの「強化」）

#### 8.8.1 強くなるのは主にラン内、ラン後に残るのは"幅"と"安定性"

- **ポイント**: 強くなるのは主にラン内、ラン後に残るのは"幅"と"安定性"
- **意味**: 永続インフレで作業化しない。毎回のビルド遊びが死なない

#### 8.8.2 基本配分の目安

- **ポイント**: 基本配分の目安
- **意味**:
  - 強さの変化：ラン内 90%／ラン間 10%
  - 残るもの：アンロック（幅） 70%／安定化 30%
  - 永続数値強化は上限を低く（長期でも頭打ち）
    でローグ感と継続動機を両立する

#### 8.8.3 撤退・敗北でも必ず清算できる

- **ポイント**: 撤退・敗北でも必ず清算できる
- **意味**: 無限/長時間で一番折れやすい「損した感」を潰す
- **例**: 到達章報酬／新規発見（図鑑）ボーナス／ビルド達成ボーナス

---

### 8.9 パークプール解放（ラン間で残す"幅"の中核）

#### 8.9.1 ラン中の3択パーク候補（くじ箱）を、実績や研究で拡張する

- **ポイント**: ラン中の3択パーク候補（くじ箱）を、実績や研究で拡張する
- **意味**: 強さを積むのではなく「面白い事故（シナジー）が起きる確率」を増やす

#### 8.9.2 パーク階層の考え方

- **ポイント**: パーク階層の考え方
- **意味**:
  - 基本パーク（最初から）
  - タグ付きパーク（所持タグで候補追加）
  - シナジー（揃うと壊れる）
  - リスク付き（強いが代償）
    を分けると設計と調整が安定する

#### 8.9.3 増やすと"欲しいのが出ない地獄"になるので制御もセット

- **ポイント**: 増やすと"欲しいのが出ない地獄"になるので制御もセット
- **意味**: リロール／ロック／タグ重み付け／後半の基本パーク排除などが必須

---

### 8.10 敵の適応・模倣（認識して真似てくる流れ）

#### 8.10.1 敵はプレイヤーを認識し、章単位で"勝ち方の原理"を学ぶ

- **ポイント**: 敵はプレイヤーを認識し、章単位で"勝ち方の原理"を学ぶ
- **意味**: ロビー介入型にピタッとはまる。次章ロビーで対策を立てる遊びが生まれる

#### 8.10.2 模倣は「完全コピー」ではなく「原理の学習」に限定

- **ポイント**: 模倣は「完全コピー」ではなく「原理の学習」に限定
- **意味**: 理不尽（詰み）を防ぎ、ローグライトの読み合いとして成立する

#### 8.10.3 進行は3段階が綺麗

- **ポイント**: 進行は3段階が綺麗
- **意味**:
  1. 耐性（受けの学習）
  2. 擬態（見た目/挙動が似てくる）
  3. 模倣（部分的に攻めを学ぶ）
     で"賢くなる怖さ"を演出しつつ納得感を保つ

#### 8.10.4 安全策（必須ルール）

- **ポイント**: 安全策（必須ルール）
- **意味**:
  - 完全コピー禁止
  - 1章で適応は最大1〜2種
  - 次章ロビーで予告（対策可能に）
  - 必ず穴（カウンター余地）を残す
    で不快感を防ぐ

---

### 8.11 表現・レンダリング（自分ロボ／敵生物の実現性）

#### 8.11.1 可能。むしろ差別化しやすい（硬いロボ vs ぬめる生物）

- **ポイント**: 可能。むしろ差別化しやすい（硬いロボ vs ぬめる生物）
- **意味**: 同じ低ポリでも「動き・質感・エフェクト」で生物感を出せる

#### 8.11.2 生物感は高ポリではなく"トリック"で出す（1000体運用に合わせる）

- **ポイント**: 生物感は高ポリではなく"トリック"で出す（1000体運用に合わせる）
- **意味**:
  - 脈動（スケール周期）
  - ゆらぎ（頂点シェーダの微変形）
  - 粘性エフェクト（被弾収縮/飛沫）
  - 群れの寄り集まり挙動
    で「生物っぽい」を成立させる

#### 8.11.3 ズームで表現レイヤーを切る

- **ポイント**: ズームで表現レイヤーを切る
- **意味**:
  - ズームアウト：簡略モデル・簡略表現（それでも1000体ロジックは稼働）
  - ズームイン：120〜220体で"最大表現"を出す
    という二階建てが現実解

#### 8.11.4 避けるべき重い表現

- **ポイント**: 避けるべき重い表現
- **意味**: 1000体すべてに本物の透過／スケルタル／高級PBR／高解像テクスチャは事故りやすい

---

### 8.12 モード（バトロワの位置づけ）

#### 8.12.1 バトルロワイアルは"ローグ要素としてモード解放"

- **ポイント**: バトルロワイアルは"ローグ要素としてモード解放"
- **意味**: 初期はコア（観戦×ビルド×章）を固め、進行で競争・観戦映えを追加する

---

### 8.13 まとめ：設計の一貫性（今の形の強み）

以下の設計思想が一貫して貫かれている：

- **ロビー/章導入で意思決定 → 本編は観戦（ズームのみ）**
- **通常は読める密度（120〜220）→ 引きで群れ快感（1000体稼働）**
- **単騎が主役 → 同僚機は捕獲/入手で増える**
- **章立て＋撤退清算 → 長時間でも迷子にならない**
- **ハクスラの強化はラン内 → ラン間はパークプール解放で"幅"を増やす**
- **敵が学習して模倣 → 次章ロビーの判断がより面白くなる**
- **自分ロボ／敵生物は、動き・質感トリックで1000体運用と両立する**

---

## 9. 参照資料

- **ユーザーリクエスト**: `docs/ユーザーのリクエスト.md`
- **プロジェクトルール**: `rules/PROJECT_AGENT.md`
- **ドメインルール**: `rules/rules_domain.md`
- **共通ルール**: `rules/common/GLOBAL_AGENT.md`

---

## 10. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2026-01-12 | 1.0 | 初版作成 | - |
| 2026-01-12 | 1.1 | キャラクターデザインを「かわいいメカ」に変更 | - |
| 2026-01-12 | 1.2 | 設計思想とコンセプト詳細セクションを追加 | - |